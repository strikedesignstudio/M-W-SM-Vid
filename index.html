<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fluid Water Droplet Effect</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/spite/ccapture.js/build/CCapture.all.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        canvas { display: block; }
        button { position: fixed; top: 20px; left: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>
    <button id="downloadButton">Download Video</button>
    <script>
        let img, shaderProgram, capturer;
        let recording = false;
        let duration = 60;
        let fps = 300;

        function preload() {
            img = loadImage("your-image.png");
            shaderProgram = loadShader('waterDistortion.vert', 'waterDistortion.frag');
        }

        function setup() {
            createCanvas(windowWidth, windowHeight, WEBGL);
            frameRate(fps);
            
            capturer = new CCapture({
                format: 'webm',
                framerate: fps,
                verbose: true
            });

            // Start recording automatically
            recording = true;
            capturer.start();

            // Button for downloading the video
            const downloadButton = document.getElementById("downloadButton");
            downloadButton.addEventListener("click", stopAndDownload);
        }

        function draw() {
            shader(shaderProgram);
            shaderProgram.setUniform('uResolution', [width, height]);
            shaderProgram.setUniform('uTime', millis() / 1000.0);
            shaderProgram.setUniform('uImage', img);
            rect(-width / 2, -height / 2, width, height);

            if (recording) {
                capturer.capture(canvas);
            }
        }

        function stopAndDownload() {
            if (recording) {
                recording = false;
                capturer.stop();
                capturer.save();
                noLoop();
            }
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>
</html>

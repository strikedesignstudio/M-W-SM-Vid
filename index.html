<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video to ASCII with p5.js</title>
    <style>
        body { text-align: center; background-color: #000; color: #00ff00; font-family: monospace; }
        pre { white-space: pre; font-size: 8px; line-height: 8px; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
</head>
<body>
    <h1>Upload Video and Render as ASCII</h1>
    <input type="file" id="upload" accept="video/mp4" />
    <pre id="ascii"></pre>

    <script>
        let video;
        let asciiDiv;
        const asciiChars = " .:-=+*#%@";
        let playing = false;

        function setup() {
            noCanvas();
            asciiDiv = select('#ascii');
            const uploadInput = select('#upload');
            uploadInput.changed(handleVideoUpload);
        }

        function handleVideoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                if (video) {
                    video.remove();
                }
                video = createVideo(url, videoLoaded);
                video.hide();
            }
        }

        function videoLoaded() {
            video.play();
            playing = true;
        }

        function draw() {
            if (playing && video) {
                const width = 80;
                const height = Math.floor(video.height / (video.width / width));
                video.size(width, height);
                video.loadPixels();

                let asciiArt = "";
                for (let y = 0; y < video.height; y++) {
                    for (let x = 0; x < video.width; x++) {
                        const index = (x + y * video.width) * 4;
                        const r = video.pixels[index];
                        const g = video.pixels[index + 1];
                        const b = video.pixels[index + 2];
                        const brightness = (r + g + b) / 3;
                        const charIndex = floor(map(brightness, 0, 255, asciiChars.length - 1, 0));
                        asciiArt += asciiChars[charIndex];
                    }
                    asciiArt += "\n";
                }
                asciiDiv.html(asciiArt);
            }
        }
    </script>
</body>
</html>